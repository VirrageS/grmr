#!/usr/bin/env perl

use strict;

my $duplicates_count = 0;

while (1) {
  my $file_name = shift @ARGV ;

  # Exit code = number of duplicates found.
  exit $duplicates_count if (!$file_name);

  open FILE, $file_name or die $!;

  my $last_word = "";
  my $line_num = 0;

  while (<FILE>) {
    chomp;

    $line_num++;

    my @words = split (/(\W+)/);

    foreach my $word (@words) {
      # Skip spaces:
      next if $word =~ /^\s*$/;

      # Skip punctuation:
      if ($word =~ /^\W+$/) {
        $last_word = "";
        next;
      }

      # Found a dup?
      if (lc($word) eq lc($last_word)) {
        print "$file_name:$line_num $word\n";
        $duplicates_count++;
      } # Thanks to Sean Cronin for tip on case.

      # Mark this as the last word:
      $last_word = $word;
    }
  }

  close FILE;
}
